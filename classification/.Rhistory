theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
p_common <- xlab("") +
theme(axis.title.x      = element_text(family = "Times", face = "plain",
size=18)) +
theme(axis.title.y      = element_text(family = "Times", face = "plain",
size=18, angle=90, vjust=0.75)) +
theme(axis.text.x       = element_text(family = "Times", face = "plain",
size=14, vjust=0.95, hjust=1, angle=45)) +
theme(axis.text.y       = element_text(family = "Times", face = "plain",
size=16, angle=0, hjust=0.5)) +
theme(axis.ticks.length = unit(.15, "lines")) +
theme(axis.ticks.margin = unit(.15,"lines")) +
theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
ggplot(df, aes(x=site, y=value, color=score)) +
geom_boxplot() +
facet_grid(rater ~ .) +
ylab("Number of Participants") +
p_common
ggplot(df, aes(x=site, y=value, color=score)) +
geom_boxplot() +
facet_grid(rater ~ .) +
ylab("Number of Participants") +
xlab("") +
theme(axis.title.x      = element_text(family = "Times", face = "plain",
size=18)) +
theme(axis.title.y      = element_text(family = "Times", face = "plain",
size=18, angle=90, vjust=0.75)) +
theme(axis.text.x       = element_text(family = "Times", face = "plain",
size=14, vjust=0.95, hjust=1, angle=45)) +
theme(axis.text.y       = element_text(family = "Times", face = "plain",
size=16, angle=0, hjust=0.5)) +
theme(axis.ticks.length = unit(.15, "lines")) +
theme(axis.ticks.margin = unit(.15,"lines")) +
theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
df <- subset(qc_anat2, measure == "cnr")
ggplot(df, aes(x=site, y=value, color=score)) +
geom_boxplot() +
facet_grid(rater ~ .) +
ylab("Number of Participants") +
xlab("") +
theme(axis.title.x      = element_text(family = "Times", face = "plain",
size=18)) +
theme(axis.title.y      = element_text(family = "Times", face = "plain",
size=18, angle=90, vjust=0.75)) +
theme(axis.text.x       = element_text(family = "Times", face = "plain",
size=14, vjust=0.95, hjust=1, angle=45)) +
theme(axis.text.y       = element_text(family = "Times", face = "plain",
size=16, angle=0, hjust=0.5)) +
theme(axis.ticks.length = unit(.15, "lines")) +
theme(axis.ticks.margin = unit(.15,"lines")) +
theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
df <- subset(qc_anat2)
ggplot(df, aes(x=measure, y=value, color=score)) +
geom_boxplot() +
facet_grid(rater ~ .) +
ylab("Number of Participants") +
xlab("") +
theme(axis.title.x      = element_text(family = "Times", face = "plain",
size=18)) +
theme(axis.title.y      = element_text(family = "Times", face = "plain",
size=18, angle=90, vjust=0.75)) +
theme(axis.text.x       = element_text(family = "Times", face = "plain",
size=14, vjust=0.95, hjust=1, angle=45)) +
theme(axis.text.y       = element_text(family = "Times", face = "plain",
size=16, angle=0, hjust=0.5)) +
theme(axis.ticks.length = unit(.15, "lines")) +
theme(axis.ticks.margin = unit(.15,"lines")) +
theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
ggplot(df, aes(x=rater, y=value, color=score)) +
geom_boxplot() +
facet_grid(measure ~ .) +
ylab("QC Value") +
xlab("") +
theme(axis.title.x      = element_text(family = "Times", face = "plain",
size=18)) +
theme(axis.title.y      = element_text(family = "Times", face = "plain",
size=18, angle=90, vjust=0.75)) +
theme(axis.text.x       = element_text(family = "Times", face = "plain",
size=14, vjust=0.95, hjust=1, angle=45)) +
theme(axis.text.y       = element_text(family = "Times", face = "plain",
size=16, angle=0, hjust=0.5)) +
theme(axis.ticks.length = unit(.15, "lines")) +
theme(axis.ticks.margin = unit(.15,"lines")) +
theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
ggplot(df, aes(x=rater, y=value, color=score)) +
geom_boxplot() +
facet_grid(measure ~ ., scales="free_y") +
ylab("QC Value") +
xlab("") +
theme(axis.title.x      = element_text(family = "Times", face = "plain",
size=18)) +
theme(axis.title.y      = element_text(family = "Times", face = "plain",
size=18, angle=90, vjust=0.75)) +
theme(axis.text.x       = element_text(family = "Times", face = "plain",
size=14, vjust=0.95, hjust=1, angle=45)) +
theme(axis.text.y       = element_text(family = "Times", face = "plain",
size=16, angle=0, hjust=0.5)) +
theme(axis.ticks.length = unit(.15, "lines")) +
theme(axis.ticks.margin = unit(.15,"lines")) +
theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
?geom_boxplot
ggplot(df, aes(x=rater, y=value, color=score)) +
geom_boxplot(outlier.shape = NA) +
facet_grid(measure ~ ., scales="free_y") +
ylab("QC Value") +
xlab("") +
theme(axis.title.x      = element_text(family = "Times", face = "plain",
size=18)) +
theme(axis.title.y      = element_text(family = "Times", face = "plain",
size=18, angle=90, vjust=0.75)) +
theme(axis.text.x       = element_text(family = "Times", face = "plain",
size=14, vjust=0.95, hjust=1, angle=45)) +
theme(axis.text.y       = element_text(family = "Times", face = "plain",
size=16, angle=0, hjust=0.5)) +
theme(axis.ticks.length = unit(.15, "lines")) +
theme(axis.ticks.margin = unit(.15,"lines")) +
theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
p0 <- ggplot(df, aes(x=rater, y=value, color=score)) +
geom_boxplot() +
facet_grid(measure ~ ., scales="free_y") +
ylab("QC Value") +
xlab("") +
theme(axis.title.x      = element_text(family = "Times", face = "plain",
size=18)) +
theme(axis.title.y      = element_text(family = "Times", face = "plain",
size=18, angle=90, vjust=0.75)) +
theme(axis.text.x       = element_text(family = "Times", face = "plain",
size=14, vjust=0.95, hjust=1, angle=45)) +
theme(axis.text.y       = element_text(family = "Times", face = "plain",
size=16, angle=0, hjust=0.5)) +
theme(axis.ticks.length = unit(.15, "lines")) +
theme(axis.ticks.margin = unit(.15,"lines")) +
theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
ylim1 <- boxplot.stats(df$value)$stats[c(1, 5)]
p1 <- p0 + coord_cartesian(ylim = ylim1*1.05)
plot(p1)
?boxplot.stats
head(df)
?tapply
?coord_cartesian
?scale_x_continuous
source("../plot_measures/qa_plot_functions.R")
df <- subset(qc_anat2)
tmp <- ddply(df, .(measure, site), function(x) {
inds <- get_outlier_inds(df)
x[!inds]
})
tmp <- ddply(df, .(measure, site), function(x) {
inds <- get_outlier_inds(x$value)
x[!inds]
})
tmp <- ddply(df, .(measure, site), function(x) {
x <- x[!is.na(x$value),]
inds <- get_outlier_inds(x$value)
x[!inds]
})
tmp <- ddply(df, .(measure, site), function(x) {
x <- x[!is.na(x$value),]
inds <- get_outlier_inds(x$value)
x[!inds,]
})
dim(tmp)
dim(df)
df <- subset(qc_anat2)
df <- ddply(df, .(measure, site), function(x) {
x <- x[!is.na(x$value),]
inds <- get_outlier_inds(x$value)
x[!inds,]
})
p0 <- ggplot(df, aes(x=rater, y=value, color=score)) +
geom_boxplot() +
facet_grid(measure ~ ., scales="free_y") +
ylab("QC Value") +
xlab("") +
theme(axis.title.x      = element_text(family = "Times", face = "plain",
size=18)) +
theme(axis.title.y      = element_text(family = "Times", face = "plain",
size=18, angle=90, vjust=0.75)) +
theme(axis.text.x       = element_text(family = "Times", face = "plain",
size=14, vjust=0.95, hjust=1, angle=45)) +
theme(axis.text.y       = element_text(family = "Times", face = "plain",
size=16, angle=0, hjust=0.5)) +
theme(axis.ticks.length = unit(.15, "lines")) +
theme(axis.ticks.margin = unit(.15,"lines")) +
theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
plot(p0)
df <- subset(qc_anat2)
p0 <- ggplot(df, aes(x=rater, y=value, color=score)) +
geom_boxplot() +
facet_grid(measure ~ ., scales="free_y") +
ylab("QC Value") +
xlab("") +
theme(axis.title.x      = element_text(family = "Times", face = "plain",
size=18)) +
theme(axis.title.y      = element_text(family = "Times", face = "plain",
size=18, angle=90, vjust=0.75)) +
theme(axis.text.x       = element_text(family = "Times", face = "plain",
size=14, vjust=0.95, hjust=1, angle=45)) +
theme(axis.text.y       = element_text(family = "Times", face = "plain",
size=16, angle=0, hjust=0.5)) +
theme(axis.ticks.length = unit(.15, "lines")) +
theme(axis.ticks.margin = unit(.15,"lines")) +
theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
plot(p0)
df <- subset(qc_anat2)
df <- ddply(df, .(measure, site), function(x) {
x <- x[!is.na(x$value),]
inds <- get_outlier_inds(x$value, 6)
x[!inds,]
})
# create boxplot that includes outliers
p0 <- ggplot(df, aes(x=rater, y=value, color=score)) +
geom_boxplot() +
facet_grid(measure ~ ., scales="free_y") +
ylab("QC Value") +
xlab("") +
theme(axis.title.x      = element_text(family = "Times", face = "plain",
size=18)) +
theme(axis.title.y      = element_text(family = "Times", face = "plain",
size=18, angle=90, vjust=0.75)) +
theme(axis.text.x       = element_text(family = "Times", face = "plain",
size=14, vjust=0.95, hjust=1, angle=45)) +
theme(axis.text.y       = element_text(family = "Times", face = "plain",
size=16, angle=0, hjust=0.5)) +
theme(axis.ticks.length = unit(.15, "lines")) +
theme(axis.ticks.margin = unit(.15,"lines")) +
theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
plot(p0)
df <- subset(qc_anat2)
df <- ddply(df, .(measure, site), function(x) {
x <- x[!is.na(x$value),]
inds <- get_outlier_inds(x$value, 6)
cat(sum(inds), "\n")
x[!inds,]
})
df <- subset(qc_anat2)
df <- ddply(df, .(measure), function(x) {
x <- x[!is.na(x$value),]
inds <- get_outlier_inds(x$value)
cat(sum(inds), "\n")
x[!inds,]
})
p0 <- ggplot(df, aes(x=rater, y=value, color=score)) +
geom_boxplot() +
facet_grid(measure ~ ., scales="free_y") +
ylab("QC Value") +
xlab("") +
theme(axis.title.x      = element_text(family = "Times", face = "plain",
size=18)) +
theme(axis.title.y      = element_text(family = "Times", face = "plain",
size=18, angle=90, vjust=0.75)) +
theme(axis.text.x       = element_text(family = "Times", face = "plain",
size=14, vjust=0.95, hjust=1, angle=45)) +
theme(axis.text.y       = element_text(family = "Times", face = "plain",
size=16, angle=0, hjust=0.5)) +
theme(axis.ticks.length = unit(.15, "lines")) +
theme(axis.ticks.margin = unit(.15,"lines")) +
theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
plot(p0)
p0 <- ggplot(df, aes(x=rater, y=value, color=score)) +
geom_boxplot(outlier.shape = NA) +
facet_grid(measure ~ ., scales="free_y") +
ylab("QC Value") +
xlab("") +
theme(axis.title.x      = element_text(family = "Times", face = "plain",
size=18)) +
theme(axis.title.y      = element_text(family = "Times", face = "plain",
size=18, angle=90, vjust=0.75)) +
theme(axis.text.x       = element_text(family = "Times", face = "plain",
size=14, vjust=0.95, hjust=1, angle=45)) +
theme(axis.text.y       = element_text(family = "Times", face = "plain",
size=16, angle=0, hjust=0.5)) +
theme(axis.ticks.length = unit(.15, "lines")) +
theme(axis.ticks.margin = unit(.15,"lines")) +
theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
plot(p0)
p0 <- ggplot(df, aes(x=rater, y=value, color=score)) +
geom_boxplot(outlier.shape = NA) +
facet_grid(measure ~ ., scales="free_y") +
ylab("QC Value") +
xlab("Rater") +
theme(axis.title.x      = element_text(family = "Times", face = "plain",
size=18)) +
theme(axis.title.y      = element_text(family = "Times", face = "plain",
size=18, angle=90, vjust=0.75)) +
theme(axis.text.x       = element_text(family = "Times", face = "plain",
size=14, vjust=0.95, hjust=1, angle=45)) +
theme(axis.text.y       = element_text(family = "Times", face = "plain",
size=16, angle=0, hjust=0.5)) +
theme(axis.ticks.length = unit(.15, "lines")) +
theme(axis.ticks.margin = unit(.15,"lines")) +
theme(plot.margin       = unit(c(1, 1, 0.25, 1), "lines"))
plot(p0)
warnings()
head(qc_anat2)
tmp <- dlply(qc_anat2, .(measure, rater), function(x) {
summary(lm(score ~ value, data=x))
})
?lm
tmp <- dlply(qc_anat2, .(measure, rater), function(x) {
summary(lm(score ~ value, data=x, na.action=na.exclude))
})
tmp <- dlply(qc_anat2, .(measure, rater), function(x) {
summary(lm(score ~ value, data=x[!is.na(x$value),]))
})
tmp <- dlply(qc_anat2, .(measure, rater), function(x) {
x2 <- x[!(is.na(x$value) | is.na(x$score)),]
summary(lm(score ~ value, data=x2))
})
head(qc_anat2)
lm(score ~ value, data=qc_anat2)
lm(value ~ value, data=qc_anat2)
lm(value ~ score, data=qc_anat2)
head(qc_anat2)
lm(as.numeric(score) ~ value, data=qc_anat2)
lm(value ~ score, data=qc_anat2)
summary(lm(value ~ score, data=qc_anat2))
summary(aov(value ~ score, data=qc_anat2))
tmp <- dlply(qc_anat2, .(measure, rater), function(x) {
x2 <- x[!(is.na(x$value) | is.na(x$score)),]
summary(aov(value ~ score, data=x2))
})
tmp[[1]]
tmp[[1]]
tmp[[1]][,4]
tmp[[1]][,3]
tmp[[1]]$Pr
tmp[[1]]$P
tmp[[1]][[1]]
tmp[[1]][[1]]$Pr
tmp[[1]][[1]]$Pr[1]
tmp <- ddply(qc_anat2, .(measure, rater), function(x) {
x2 <- x[!(is.na(x$value) | is.na(x$score)),]
summary(aov(value ~ score, data=x2))[[1]]$Pr[1]
})
tmp
head(qc_anat2)
levels(qc_anat2)
levels(qc_anat2$score)
levels(qc_anat2)
levels(qc_anat2$rater)
levels(qc_anat2$score)
as.factor(qc_anat2$score)
aov(value ~ score, data=qc_anat2)
aov(score ~ value, data=qc_anat2)
aov(as.numeric(score) ~ value, data=qc_anat2)
as.numeric(qc_anat2$score)
as.numeric(qc_anat2)
as.numeric(qc_anat2$score)
as.factor(qc_anat2$score)
aov(as.factor(score) ~ value, data=qc_anat2)
aov(as.numeric(as.factor(score)) ~ value, data=qc_anat2)
summary(aov(as.numeric(as.factor(score)) ~ value, data=qc_anat2))
qc_anat2$score <- factor(qc_anat2$score)
summary(aov(as.numeric(score) ~ value, data=qc_anat2))
summary(aov(score ~ value, data=qc_anat2))
tmp2 <- ddply(qc_anat2, .(measure, rater), function(x) {
x2 <- x[!(is.na(x$value) | is.na(x$score)),]
summary(aov(as.numeric(score) ~ value, data=qc_anat2))[[1]]$Pr[1]
})
tmp2
tmp2 <- ddply(qc_anat2, .(measure, rater), function(x) {
x2 <- x[!(is.na(x$value) | is.na(x$score)),]
summary(aov(as.numeric(score) ~ value, data=x2))[[1]]$Pr[1]
})
tmp2
score
mylogit <- glm(rater_3 ~ cnr + efc + fwhm + qi1, data=qc_anat, family="binomial")
summary(mylogit)
summary(mylogit)$Coef
summary(mylogit)[[1]]
tmptmp <- summary(mylogit)
tmptmp$coefficients
tmptmp$coefficients$Pr
tmptmp$coefficients[[1]]
tmptmp$coefficients[4,]
tmptmp$coefficients[2,]
tmptmp$coefficients[2,]$Pr
tmptmp$coefficients[2,4]
tmp2 <- ddply(qc_anat2, .(measure, rater), function(x) {
score <- as.character(x$score)
score[score == "maybe"] <- NA
x$score <- factor(score)
x2 <- x[!(is.na(x$value) | is.na(x$score)),]
mylogit <- glm(score ~ value, data=x2, family="binomial")
summary(mylogit)$coefficients[2,4]
})
tmp2 <- dlply(qc_anat2, .(measure, rater), function(x) {
score <- as.character(x$score)
score[score == "maybe"] <- NA
x$score <- factor(score)
x2 <- x[!(is.na(x$value) | is.na(x$score)),]
return(x2)
mylogit <- glm(score ~ value, data=x2, family="binomial")
summary(mylogit)$coefficients[2,4]
})
mylogit <- glm(score ~ value, data=tmp2[[1]], family="binomial")
summary(mylogit)
summary(mylogit)$coefficients[2,4]
mylogit <- glm(score ~ value, data=tmp2[[2]], family="binomial")
mylogit <- glm(score ~ value, data=tmp2[[3]], family="binomial")
mylogit <- glm(score ~ value, data=tmp2[[4]], family="binomial")
tmp2 <- dlply(qc_anat2, .(measure, rater), function(x) {
cat(x$measure[1], x$rater[1], "\n")
score <- as.character(x$score)
score[score == "maybe"] <- NA
x$score <- factor(score)
x2 <- x[!(is.na(x$value) | is.na(x$score)),]
#return(x2)
mylogit <- glm(score ~ value, data=x2, family="binomial")
summary(mylogit)$coefficients[2,4]
})
tmp2 <- dlply(qc_anat2, .(measure, rater), function(x) {
cat(as.character(x$measure[1]), as.character(x$rater[1]), "\n")
score <- as.character(x$score)
score[score == "maybe"] <- NA
x$score <- factor(score)
x2 <- x[!(is.na(x$value) | is.na(x$score)),]
#return(x2)
mylogit <- glm(score ~ value, data=x2, family="binomial")
summary(mylogit)$coefficients[2,4]
})
mylogit <- glm(score ~ value, data=tmp2[[17]], family="binomial")
tmp2 <- dlply(qc_anat2, .(measure, rater), function(x) {
cat(as.character(x$measure[1]), as.character(x$rater[1]), "\n")
score <- as.character(x$score)
score[score == "maybe"] <- NA
x$score <- factor(score)
x2 <- x[!(is.na(x$value) | is.na(x$score)),]
return(x2)
#mylogit <- glm(score ~ value, data=x2, family="binomial")
#summary(mylogit)$coefficients[2,4]
})
mylogit <- glm(score ~ value, data=tmp2[[17]], family="binomial")
summary(mylogit)$coefficients[2,4]
mylogit <- glm(score ~ value, data=tmp2[[18]], family="binomial")
summary(mylogit)$coefficients[2,4]
tmp2[[18]]
head(tmp2[[18]])
table(tmp2[[18]]$score)
table(tmp2[[17]]$score)
table(tmp2[[16]]$score)
table(tmp2[[15]]$score)
table(qc_anat$rater_1)
table(qc_anat$rater_2)
table(qc_anat$rater_3)
tmp2 <- dlply(qc_anat2, .(measure, rater), function(x) {
cat(as.character(x$measure[1]), as.character(x$rater[1]), "\n")
score <- as.character(x$score)
score[score == "maybe"] <- "fail"
x$score <- factor(score)
x2 <- x[!(is.na(x$value) | is.na(x$score)),]
mylogit <- glm(score ~ value, data=x2, family="binomial")
summary(mylogit)$coefficients[2,4]
})
tmp2 <- ddply(qc_anat2, .(measure, rater), function(x) {
cat(as.character(x$measure[1]), as.character(x$rater[1]), "\n")
score <- as.character(x$score)
score[score == "maybe"] <- "fail"
x$score <- factor(score)
x2 <- x[!(is.na(x$value) | is.na(x$score)),]
mylogit <- glm(score ~ value, data=x2, family="binomial")
summary(mylogit)$coefficients[2,4]
})
tmp2
tmp3 <- ddply(qc_anat2, .(measure, rater), function(x) {
cat(as.character(x$measure[1]), as.character(x$rater[1]), "\n")
score <- as.character(x$score)
score[score == "maybe"] <- "fail"
x$score <- factor(score)
x2 <- x[!(is.na(x$value) | is.na(x$score)),]
mylogit <- glm(score ~ value, data=x2, family="binomial")
summary(mylogit)$coefficients[2,4]
})
tmp3
tmp3$V1 <- round(tmp3$V1, 4)
tmp3$V1
tmp3$sig <- tmp3$V1 < 0.05
tmp3
x <- qc_anat
cat(as.character(x$measure[1]), as.character(x$rater[1]), "\n")
score <- as.character(x$score)
score[score == "maybe"] <- "fail"
x$score <- factor(score)
x2 <- x[!(is.na(x$value) | is.na(x$score)),]
mylogit <- glm(rater_1 ~ cnr + efc + fwhm + fber + qi1 + snr, data=x2, family="binomial")
summary(mylogit)
?glm
?na.exclude
x <- qc_anat
x$score <- x$rater_1
score <- as.character(x$score)
score[score == "maybe"] <- "fail"
x$score <- factor(score)
mylogit <- glm(score ~ cnr + efc + fwhm + fber + qi1 + snr, data=x, family="binomial", na.action=na.omit)
summary(mylogit)
x <- qc_anat
x$score <- x$rater_2
score <- as.character(x$score)
score[score == "maybe"] <- "fail"
x$score <- factor(score)
mylogit <- glm(score ~ cnr + efc + fwhm + fber + qi1 + snr, data=x, family="binomial", na.action=na.omit)
summary(mylogit)
# Rater 3
## fwhm significant, qi1, and snr somewhat significant
x <- qc_anat
x$score <- x$rater_3
score <- as.character(x$score)
score[score == "maybe"] <- "fail"
x$score <- factor(score)
mylogit <- glm(score ~ cnr + efc + fwhm + fber + qi1 + snr, data=x, family="binomial", na.action=na.omit)
summary(mylogit)
